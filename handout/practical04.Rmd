---
title: "Méthodes biostatistiques"
subtitle: "Modèles à effets aléatoires"
---

Les paramètres suivants doivent être définis dans R ou RStudio afin de reproduire les analyses présentées dans ce document. Les packages **ggplot2**, **hrbrthemes**, **directlabels**, **cowplot**, **texreg** et **rms** ne font pas partie de la distribution R et doivent être téléchargés au préalable (`install.packages(c("ggplot2", "hrbrthemes", "directlabels", "cowplot", "texreg", "rms")`) s'ils ne sont pas déjà installés. Les dépendances de ces packages seront installés automatiquement. On supposera également que les instructions R sont exécutées dans un répertoire de travail avec les fichiers de données accessibles dans un sous-répertoire `data/`. Si ce n'est pas le cas, il suffit de créer un sous-répertoire `data/` et d'y enregistrer les fichiers de données, ou de redéfinir les chemins d'accès dans les instructions de lecture des fichiers de données ci-après.
```{r, message = FALSE}
library(hrbrthemes)
library(directlabels)
library(cowplot)
library(Hmisc)
library(reshape2)
options(digits = 6, show.signif.stars = FALSE)
theme_set(theme_ipsum(base_size = 11))
```


# ANOVA et modèles à effets aléatoires

## Chargement des données

## Description des variables

## Modélisation



# Cas des données longitudinales

## Chargement des données

```{r}
sepsis <- foreign::read.dta("../data/sepsis.dta")
str(sepsis)
```

Voici quelques pré-traitements utiles :
```{r}
sepsis$treat <- as.factor(sepsis$treat)
sepsis$id <- factor(sepsis$id)
sepsis.long <- melt(sepsis, measure.vars = 8:14, id.vars = 1:2)
celsius2fahr <- function(x) (x-32) / 1.8
sepsis.long$value <- celsius2fahr(sepsis.long$value)
```

## Description des variables


```{r}
p <- ggplot(data = na.omit(sepsis.long), aes(x = variable, y = value)) +
       geom_line(aes(group = id), col = grey(.7), alpha = .2) +
       geom_line(data = subset(na.omit(sepsis.long), variable %in% c("temp0", "temp1")),
                 aes(group = id, color = treat)) +
       scale_x_discrete(labels = seq(0, 6*2, by = 2)) +
       scale_y_continuous(breaks = seq(31.5, 43, by = 1.5)) +
       scale_color_manual("", values = c("steelblue", "orange")) +
       labs(x = "Durée de suivi (heure)", y = "Température (°C)") +
       theme(legend.position = c(.5, 1.05), legend.direction = "horizontal")
p
```


```{r}
p <- ggplot(data = na.omit(sepsis.long), aes(x = variable, y = value)) +
       geom_line(aes(group = id), col = grey(.7), alpha = .2) +
       geom_line(data = subset(na.omit(sepsis.long),
                               variable %in% c("temp0", "temp1") & treat == "Ibuprofen"),
                 aes(group = id), color = "orange") +
       scale_x_discrete(labels = seq(0, 6*2, by = 2)) +
       scale_y_continuous(breaks = seq(31.5, 43, by = 1.5)) +
       labs(x = "Durée de suivi (heure)", y = "Température (°C)")
p
```

```{r}
d <- with(sepsis.long, summarize(value, llist(treat, variable), smean.cl.normal))

p <- ggplot(data = d, aes(x = variable, y = value, shape = treat, color = treat)) +
  geom_point(size = 2) +
  geom_line(aes(group = treat)) +
  geom_errorbar(aes(ymin=Lower, ymax=Upper), width=.1) +
  scale_color_manual("", values = c("steelblue", "orange")) +
  scale_x_discrete(labels = seq(0, 6*2, by = 2)) +
  guides(color = FALSE, shape = FALSE) +
  geom_dl(aes(label = treat), method = list("smart.grid", cex = .8)) +
  labs(x = "Durée de suivi (heure)", y = "Température (°C)")
p
```


## Approche par modèle mixte


## Approche par équations généralisées
